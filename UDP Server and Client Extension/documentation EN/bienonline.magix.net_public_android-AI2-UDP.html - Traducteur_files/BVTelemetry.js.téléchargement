var BvTelemetry;(function(BvTelemetry){var TelemetryProviderConfig=function(){function TelemetryProviderConfig(){}return TelemetryProviderConfig}();BvTelemetry.TelemetryProviderConfig=TelemetryProviderConfig;var PageInformation=function(){function PageInformation(){}return PageInformation}();BvTelemetry.PageInformation=PageInformation;var DisplayData=function(){function DisplayData(){}return DisplayData}();BvTelemetry.DisplayData=DisplayData;var ActionData=function(){function ActionData(){}return ActionData}();BvTelemetry.ActionData=ActionData;var Metric=function(){function Metric(){}return Metric}();BvTelemetry.Metric=Metric;var ErrorData=function(){function ErrorData(){}return ErrorData}();BvTelemetry.ErrorData=ErrorData;var ReferrerInfo=function(){function ReferrerInfo(){}return ReferrerInfo}();BvTelemetry.ReferrerInfo=ReferrerInfo;(function(Action){Action._map=[];Action._map[0]="Click";Action.Click=0;Action._map[1]="Hover";Action.Hover=1;Action._map[2]="ValueChange";Action.ValueChange=2;Action._map[3]="Submit";Action.Submit=3;Action._map[4]="Scroll";Action.Scroll=4;Action._map[5]="Message";Action.Message=5})(BvTelemetry.Action||(BvTelemetry.Action={}));var Action=BvTelemetry.Action;(function(ElementType){ElementType._map=[];ElementType._map[0]="Button";ElementType.Button=0;ElementType._map[1]="Form";ElementType.Form=1;ElementType._map[2]="Image";ElementType.Image=2;ElementType._map[3]="Text";ElementType.Text=3;ElementType._map[4]="Page";ElementType.Page=4;ElementType._map[5]="Link";ElementType.Link=5;ElementType._map[6]="DropDown";ElementType.DropDown=6;ElementType._map[7]="Banner";ElementType.Banner=7})(BvTelemetry.ElementType||(BvTelemetry.ElementType={}));var ElementType=BvTelemetry.ElementType;(function(Severity){Severity._map=[];Severity._map[0]="Warning";Severity.Warning=0;Severity._map[1]="Error";Severity.Error=1;Severity._map[2]="Crash";Severity.Crash=2})(BvTelemetry.Severity||(BvTelemetry.Severity={}));var Severity=BvTelemetry.Severity})(BvTelemetry||(BvTelemetry={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}__.prototype=b.prototype;d.prototype=new __},BvTelemetry;(function(BvTelemetry){var AriaConfig=function(_super){__extends(AriaConfig,_super);function AriaConfig(){_super.apply(this,arguments)}return AriaConfig}(BvTelemetry.TelemetryProviderConfig);BvTelemetry.AriaConfig=AriaConfig;var AriaClient=function(){function AriaClient(){}AriaClient.prototype.init=function(config,callback,context){this.config=config;this.loadAriaSdk(callback,context)};AriaClient.prototype.isInitialized=function(){return this.logManager!==undefined};AriaClient.prototype.setContext=function(key,value){if(this.logManager!==undefined)this.logManager.setContext(key,value)};AriaClient.prototype.trackPageView=function(info){this.logEvent({name:"pageview",type:"pageview",properties:{"PageView.Id":info.pageName,"PageView.Name":info.pageName,"PageView.ReferrerUri":info.referrer?info.referrer.domain:null,"PageView.ReferrerPath":info.referrer?info.referrer.path:null,"PageView.ReferrerQuery":info.referrer?info.referrer.search:null,"PageView.IsRedirect":info.isRedirect===undefined?null:info.isRedirect,TransURL:info.targetUrl,"TransURL.Query":info.targetUrlSearch,FromLanguage:info.fromLanguage,ToLanguage:info.toLanguage,Layout:info.layout,DisplayLanguage:info.displayLanguage,NavigatorLanuage:info.browserLanguage,RefTag:info.refTag}})};AriaClient.prototype.trackDisplay=function(display){var pageName=display.page?display.page.pageName:null,elementType=display.elementType?BvTelemetry.ElementType[display.elementType]:null;this.logEvent({name:"display",properties:{element:display.elementName,type:elementType,page:pageName}})};AriaClient.prototype.trackInteraction=function(action){var pageName=action.page?action.page.pageName:null,elementType=action.elementType?BvTelemetry.ElementType[action.elementType]:null,actionType=action.action?BvTelemetry.Action[action.action]:null;this.logEvent({name:"action",properties:{action:actionType,source:action.elementName,elementType:elementType,page:pageName,params:action.params,external:action.isExternal}})};AriaClient.prototype.trackMetric=function(metrics,page){var fromLanguage=null,toLangauge=null;if(page!==undefined&&page!==null){fromLanguage=page.fromLanguage;toLangauge=page.toLanguage}var properties={FromLanguage:fromLanguage,ToLanguage:toLangauge};for(var i=0;i<metrics.length;i++)properties[metrics[i].metric]=metrics[i].value;this.logEvent({name:"metric",properties:properties})};AriaClient.prototype.trackError=function(error){var severity=error.severity?BvTelemetry.Severity[error.severity]:null,pageName=error.page?error.page.pageName:null;this.logEvent({name:"failure",type:"failure",properties:{"Failure.Signature":error.error,"Failure.Detail":error.message,"Failure.Category":severity,"Failure.Id":error.traceId,source:error.source,location:error.line!==undefined||error.column!==undefined?"("+error.line+","+error.column+")":null,window:error.window,page:pageName}})};AriaClient.prototype.logEvent=function(event){if(this.logManager===null)return;this.logManager.logEvent(event)};AriaClient.prototype.loadAriaSdk=function(callback,context){var _this=this,s=document.createElement("script");s.onload=function(){_this.initClient();if(callback!==undefined)callback(context)};s.src=this.config.scriptLocation;document.getElementsByTagName("head")[0].appendChild(s)};AriaClient.prototype.initClient=function(){if(this.config.disableCookiesUsage===undefined)this.config.disableCookiesUsage=false;var semanticContext=AWTLogManager.getSemanticContext();if(this.config.userId!==undefined)semanticContext.setUserId(this.config.userId);semanticContext.setAppVersion(this.config.appVersion);this.logManager=AWTLogManager.initialize(this.config.tenantId,{disableCookiesUsage:this.config.disableCookiesUsage});this.setContext("SessionId",this.config.sessionId);this.setContext("RequestId",this.config.requestId)};return AriaClient}();BvTelemetry.AriaClient=AriaClient})(BvTelemetry||(BvTelemetry={}));var BvTelemetry;(function(BvTelemetry){var TelemetryProviderFactory=function(){function TelemetryProviderFactory(){this.ariaTelemetry=new BvTelemetry.AriaClient}TelemetryProviderFactory.prototype.getTelemetryProvider=function(){return this.ariaTelemetry};return TelemetryProviderFactory}();BvTelemetry.TelemetryProviderFactory=TelemetryProviderFactory})(BvTelemetry||(BvTelemetry={}));var BvTelemetry;(function(BvTelemetry){var Control=function(){function Control(){}Control.inputUrlText="input_url";Control.languageSelector="lang_select";Control.translateButton="go_button";Control.layoutControl="layout_control";Control.cookieBanner="mscc_consent";Control.cookieBannerDetails="mscc_learn_more";Control.secureWarningDismiss="secure_warning_dismiss";Control.reportPageLink="report_page";Control.originalPageLink="original_page";return Control}();BvTelemetry.Control=Control;var TelemetrySettings=function(){function TelemetrySettings(){}return TelemetrySettings}();BvTelemetry.TelemetrySettings=TelemetrySettings;var TelemetryClient=function(){function TelemetryClient(){this.deferredEvts=[];this.context=this;this.settings=null}TelemetryClient.prototype.init=function(settings,provider,page){if(provider===undefined||provider===null){var factory=new BvTelemetry.TelemetryProviderFactory;provider=factory.getTelemetryProvider()}this.settings=this.initSettings(settings);this.getAndUpdatePageInfo(page);this.provider=provider;this.provider.init(settings.providerConfig,this.postInit,this.context)};TelemetryClient.prototype.trackPageView=function(info){info=this.getAndUpdatePageInfo(info);this.enqueueOrTrack({type:"page",evt:info})};TelemetryClient.prototype.trackInteraction=function(action){this.enqueueOrTrack({type:"action",evt:action})};TelemetryClient.prototype.trackMetric=function(metrics){this.enqueueOrTrack({type:"metric",evt:metrics})};TelemetryClient.prototype.trackDisplay=function(display){this.enqueueOrTrack({type:"display",evt:display})};TelemetryClient.prototype.trackError=function(error){this.enqueueOrTrack({type:"error",evt:error})};TelemetryClient.prototype.trackButtonClick=function(id,params,isExternal){var action=new BvTelemetry.ActionData;action.action=BvTelemetry.Action.Click;action.elementType=BvTelemetry.ElementType.Button;action.elementName=id;action.params=params;action.isExternal=isExternal;action.page=this.getAndUpdatePageInfo();this.trackInteraction(action)};TelemetryClient.prototype.trackValueChange=function(id,newValue,isExternal){var action=new BvTelemetry.ActionData;action.action=BvTelemetry.Action.ValueChange;action.elementType=BvTelemetry.ElementType.Text;action.elementName=id;action.params=this.sanitizeUrl(newValue);action.isExternal=isExternal;action.page=this.getAndUpdatePageInfo();this.trackInteraction(action)};TelemetryClient.prototype.trackClick=function(id,params,isExternal){var action=new BvTelemetry.ActionData;action.action=BvTelemetry.Action.Click;action.elementType=BvTelemetry.ElementType.Link;action.elementName=id;action.params=params;action.isExternal=isExternal;action.page=this.getAndUpdatePageInfo();this.trackInteraction(action)};TelemetryClient.prototype.trackOptionChange=function(id,params,isExternal){var action=new BvTelemetry.ActionData;action.action=BvTelemetry.Action.Click;action.elementType=BvTelemetry.ElementType.DropDown;action.elementName=id;action.params=params;action.isExternal=isExternal;action.page=this.getAndUpdatePageInfo();this.trackInteraction(action)};TelemetryClient.prototype.trackErrorOnWindow=function(window,id,trackFrames){if(trackFrames===undefined)trackFrames=this.settings.trackFrameScriptError;if(window.onerror!==null)return;this.hookUpErrorHandler(window,id);if(trackFrames&&window.frames!==undefined)for(var i=0;i<window.frames.length;i++)try{var windowName=this.getWindowName(window.frames[i]);if(window.frames[i].onerror===null)this.hookUpErrorHandler(window.frames[i],windowName)}catch(e){}};TelemetryClient.prototype.initSettings=function(settings){if(settings===undefined||settings===null)throw"Telemetry Settings cannot be empty";if(settings.providerConfig===undefined||settings.providerConfig===null)throw"Provider settings cannot be empty";if(settings.autoTrackClick===undefined)settings.autoTrackClick=false;if(settings.autoTrackPageView===undefined)settings.autoTrackPageView=true;if(settings.autoTrackScriptError===undefined)settings.autoTrackScriptError=true;if(settings.trackFrameScriptError===undefined)settings.trackFrameScriptError=false;if(settings.defaultSeverity===undefined)settings.defaultSeverity=BvTelemetry.Severity.Warning;if(settings.windowName===undefined)settings.windowName=this.getWindowName(window);if(settings.pageName===undefined)settings.pageName=this.getPageName();return settings};TelemetryClient.prototype.postInit=function(context){if(context.settings.autoTrackPageView)context.trackPageView(context.pageInfo);if(context.settings.autoTrackScriptError)context.trackErrorOnWindow(window,context.settings.windowName,context.settings.trackFrameScriptError);if(context.deferredEvts!==undefined&&context.deferredEvts.length>0)for(var i=0;i<context.deferredEvts.length;i++)context.track(context.deferredEvts[i])};TelemetryClient.prototype.enqueueOrTrack=function(event){if(this.provider!==undefined&&this.provider.isInitialized())this.track(event);else this.deferredEvts.push(event)};TelemetryClient.prototype.track=function(event){switch(event.type){case "page":var info=event.evt;this.provider.trackPageView(info);break;case "action":var action=event.evt;this.provider.trackInteraction(action);break;case "metric":var page=this.getAndUpdatePageInfo(),metrics=event.evt;this.provider.trackMetric(metrics,page);break;case "display":var display=event.evt;this.provider.trackDisplay(display);break;case "error":var error=event.evt;this.provider.trackError(error);break}};TelemetryClient.prototype.getAndUpdatePageInfo=function(page){var info;if(page===undefined)if(this.pageInfo!==undefined)info=this.pageInfo;else{info=new BvTelemetry.PageInformation;info.pageName=this.settings&&this.settings.pageName||this.getPageName()}else info=page;if(typeof LangPair!=="undefined")try{if(this.isStringNullOrEmpty(info.fromLanguage)&&LangPair.getToLang)info.fromLanguage=LangPair.getFromLang();if(this.isStringNullOrEmpty(info.toLanguage)&&LangPair.getToLang)info.toLanguage=LangPair.getToLang()}catch(e){}if(typeof Layout!=="undefined"&&Layout.Properties)try{if(this.isStringNullOrEmpty(info.targetUrl)&&Layout.Properties.GetUrlValue)info.targetUrl=Layout.Properties.GetUrlValue();if(this.isStringNullOrEmpty(info.layout)&&Layout.Properties.ActiveView)info.layout=Layout.Properties.ActiveView}catch(e){}if(typeof Util!=="undefined"&&Util.GetUrlParameter){if(this.isStringNullOrEmpty(info.fromLanguage))info.fromLanguage=Util.GetUrlParameter(window.location.href,"from");if(this.isStringNullOrEmpty(info.toLanguage))info.toLanguage=Util.GetUrlParameter(window.location.href,"to");if(this.isStringNullOrEmpty(info.targetUrl))info.targetUrl=Util.GetUrlParameter(window.location.href,"a");if(this.isStringNullOrEmpty(info.displayLanguage))info.displayLanguage=Util.GetUrlParameter(window.location.href,"dl");if(this.isStringNullOrEmpty(info.layout))info.layout=Util.GetUrlParameter(window.location.href,"lo");if(this.isStringNullOrEmpty(info.refTag))info.refTag=Util.GetUrlParameter(window.location.href,"ref");if(info.referrer&&this.isStringNullOrEmpty(info.referrer.domain))info.referrer.domain=Util.GetUrlParameter(window.location.href,"refd");var isRedirect=Util.GetUrlParameter(window.location.href,"r");if(isRedirect!==null)info.isRedirect=isRedirect.toLowerCase()==="true"}if(info.targetUrl!=undefined)info.targetUrl=this.sanitizeUrl(info.targetUrl);this.pageInfo=info;return info};TelemetryClient.prototype.getPageName=function(){return this.getWindowName(window)};TelemetryClient.prototype.getWindowName=function(window){var windowName=window.location.pathname;if(windowName===undefined||windowName===null||windowName==="")return "";windowName=windowName.replace("/","");windowName=windowName.split(".")[0];windowName=windowName.split("?")[0];return windowName};TelemetryClient.prototype.hookUpErrorHandler=function(window,id){var that=this;window.onerror=function(message,url,line,col,error){that.onUnhandledError(message,url,line,col,error,id)}};TelemetryClient.prototype.onUnhandledError=function(message,url,line,col,error,windowId){if(url===undefined||url===null||url==="")return;url=this.sanitizeUrl(url);var errorData=new BvTelemetry.ErrorData;errorData.error="Unhandled";errorData.message=message;errorData.source=url;errorData.window=windowId;errorData.severity=this.getSeverity(message,url,error,windowId);errorData.line=line;errorData.column=col;errorData.page=this.getAndUpdatePageInfo();this.trackError(errorData)};TelemetryClient.prototype.sanitizeUrl=function(url){if(url===undefined||url===null)return null;return url.split(/[?#@]/)[0]};TelemetryClient.prototype.isStringNullOrEmpty=function(text){return text===undefined||text===null||text===""};TelemetryClient.prototype.getSeverity=function(message,url,error,windowId){if(url===undefined||url===null)return BvTelemetry.Severity.Warning;url=url.toLowerCase();if(url.indexOf("bvsandbox.aspx")>0||url.indexOf("bv.aspx")>0||url.indexOf("proxy.ashx")>0||url.indexOf("toolkit.ashx")>0)return BvTelemetry.Severity.Crash;if(url.indexOf("mt.js")>0)return BvTelemetry.Severity.Error;return this.settings&&this.settings.defaultSeverity||BvTelemetry.Severity.Warning};return TelemetryClient}();BvTelemetry.TelemetryClient=TelemetryClient})(BvTelemetry||(BvTelemetry={}));var telemetry=new BvTelemetry.TelemetryClient